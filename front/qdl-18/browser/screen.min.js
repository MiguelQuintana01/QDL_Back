function getDomain(){let domain="";return domain=window.location.origin.includes("localhost")?"http://localhost:8000":window.location.origin,domain}async function setTimeToP(){if(window.location.href.includes("screen")){const clocks=document.getElementsByClassName("clock");if(clocks.length>0){const clock=clocks[0];clock.innerHTML=obtenerFechaHoraFormateada()}}}async function setMetasWeights(){try{const lastMeta=await getLastMeta();setTextMeta(numberToFormat(lastMeta.meta));const weight=await getMetaWeight();setTextWeight(numberToFormat(weight)),createChart(lastMeta,weight)}catch(e){console.log(e)}}function obtenerFechaHoraFormateada(){let now=new Date,daysOfWeek,monthsOfYear=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],dayOfWeek,day,month,year,hours,minutes,seconds,formattedDate;return`${["domingo","lunes","martes","miércoles","jueves","viernes","sábado"][now.getDay()]}, ${String(now.getDate()).padStart(2,"0")} de ${monthsOfYear[now.getMonth()]} de ${now.getFullYear()} ${String(now.getHours()).padStart(2,"0")}:${String(now.getMinutes()).padStart(2,"0")}:${String(now.getSeconds()).padStart(2,"0")}`}async function getAllMetas(){const response=await fetch(getDomain()+"/api/settings/metas");return await response.json()}async function getLastMeta(){const metas=await getAllMetas(),actualHourInSeconds=3600*(new Date).getHours();let meta={};for(let i=metas.dates.length-1;i>=0;i--)if(metas.dates[i]<=actualHourInSeconds){meta.date=metas.dates[i],meta.meta=metas.weights[i],meta.dateDate=unixToDates([meta.date])[0];break}return meta}async function getLastMeta2(){const response=await fetch(getDomain()+"/api/metas");let data=await response.json();return data.dateDate=unixToDates([data.date])[0],data}function setTextMeta(value){document.getElementById("metaP").innerHTML=value}function setTextWeight(value){document.getElementById("weightP").innerHTML=value}function getDateWithOutTimeUnix(){const ahora=new Date,fechaSinTiempo=new Date(ahora.getFullYear(),ahora.getMonth(),ahora.getDate()),timestampUnix=Math.floor(fechaSinTiempo.getTime()/1e3);return timestampUnix}async function getMetaWeight(){const period={start:getDateWithOutTimeUnix(),gmt:getGmt()},weight=await(await makePost(getDomain()+"/api/weights",period)).json();let lastWeightMeta;return sumarice(weight.peso)}function unixToDates(listDates){let dates=[];return listDates.forEach(dateUnix=>{dates.push(new Date(1e3*dateUnix))}),dates}function generateForm(data){let form=new FormData;const keys=Object.keys(data);return keys.forEach(key=>{form.append(key,data[key])}),form}function sumarice(nums){let acumulate=0;return nums.forEach(actual=>{acumulate+=actual}),acumulate}function numberToFormat(value){const formatedNumber=(Math.round(100*value)/100).toLocaleString()+"kg";return formatedNumber}function getGmt(){return-(new Date).getTimezoneOffset()/60}async function makePost(url,data){const params=generateForm(data),response=await fetch(url,{method:"POST",body:params});return response}async function createCanvas(width,height){const canvas=document.createElement("canvas");return canvas.id="pieChart",canvas.width=width,canvas.height=height,canvas}async function createChart(lastMeta,weight){if("undefined"==typeof window)return;const innerWidth=window.innerWidth,innerHeight=window.innerHeight,container=document.getElementById("pieContainer"),ctx=await createCanvas(.7*innerWidth,.7*innerHeight);container.innerHTML="",container.appendChild(ctx);let metaRestant=lastMeta.meta-weight;metaRestant=metaRestant>=0?metaRestant:0,new Chart(ctx,{type:"pie",data:{datasets:[{data:[weight,metaRestant],backgroundColor:["#36A2EB","#ffd4a1"],hoverBackgroundColor:["#36A2EB","#ffd4a1"]}]},options:{responsive:!0,maintainAspectRatio:!1,animation:{duration:0}}})}"undefined"!=typeof window&&(setInterval(setTimeToP,990),setMetasWeights(),setInterval(setMetasWeights,1e4));